# çŸ©å½¢è½¦è¾†é¿éšœæµ‹è¯•æŒ‡å—

## æ›´æ–°å†…å®¹

### âœ… è½¦è¾†æ¨¡å‹æ”¹è¿›
- **æ—§æ¨¡å‹**: åœ†å½¢æœºå™¨äººï¼ˆrobot_radiusï¼‰
- **æ–°æ¨¡å‹**: çŸ©å½¢è½¦è¾†ï¼ˆvehicle_length Ã— vehicle_widthï¼‰

### ğŸš— è½¦è¾†å‚æ•°é…ç½®

åœ¨ `config/frenet_params.yaml`:
```yaml
# Costmapé¿éšœå‚æ•° (çŸ©å½¢è½¦è¾†æ¨¡å‹)
vehicle_length: 1.0      # è½¦è¾†é•¿åº¦ (m)
vehicle_width: 0.6       # è½¦è¾†å®½åº¦ (m)
costmap_obstacle_threshold: 50
```

### çŸ©å½¢ç¢°æ’æ£€æµ‹åŸç†

```
è½¦è¾†è½®å»“ï¼ˆä¿¯è§†å›¾ï¼‰ï¼š
    
    width (0.6m)
    â†----------â†’
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â†‘
    â”‚          â”‚  â”‚
    â”‚    â—     â”‚  â”‚ length (1.0m)
    â”‚ (center) â”‚  â”‚
    â”‚          â”‚  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â†“

æ£€æµ‹åŒºåŸŸï¼š
- éå†è½¦è¾†çŸ©å½¢è¦†ç›–çš„æ‰€æœ‰costmapæ …æ ¼
- æ£€æŸ¥æ¯ä¸ªæ …æ ¼çš„ä»£ä»·å€¼
- ä»»ä¸€æ …æ ¼è¶…è¿‡é˜ˆå€¼å³åˆ¤å®šä¸ºç¢°æ’
```

## æµ‹è¯•è„šæœ¬è¯´æ˜

### test_publisher.py åŠŸèƒ½

å‘å¸ƒä»¥ä¸‹æµ‹è¯•è¯é¢˜ï¼š
1. `/local_path_plan` - ç›´çº¿å‚è€ƒè·¯å¾„ï¼ˆ10ç±³ï¼‰
2. `/local_vel_cmd` - å‚è€ƒé€Ÿåº¦ï¼ˆ2.0 m/sï¼‰
3. `/odom` - è™šæ‹Ÿè½¦è¾†ä½ç½®ï¼ˆèµ·ç‚¹6må¤„ï¼‰
4. `/costmap` - å±€éƒ¨ä»£ä»·åœ°å›¾ï¼ˆ20mÃ—10mï¼‰

### Costmapå¸ƒå±€

```
åœ°å›¾èŒƒå›´: 20m (x) Ã— 10m (y)
åˆ†è¾¨ç‡: 0.1m
åæ ‡ç³»: map

éšœç¢ç‰©åˆ†å¸ƒ:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” y=5m
â”‚                                     â”‚
â”‚         â—                           â”‚  â† éšœç¢1 (8m, 0.5m)
â”‚ èµ·ç‚¹                                â”‚
â”‚  â†“                                  â”‚
â”‚â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â”‚ y=0 (å‚è€ƒè·¯å¾„)
â”‚            â—                        â”‚  â† éšœç¢2 (12m, -0.8m)
â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ y=-5m
x=0                               x=20m

è¾¹ç•Œ: y=Â±1.8m å¤„æœ‰ä»£ä»·å€¼80çš„è½¯è¾¹ç•Œ
```

## è¿è¡Œæ–¹æ³•

### æ–¹æ³•1: ä¸€é”®å¯åŠ¨ï¼ˆæ¨èï¼‰
```bash
source install/setup.bash
ros2 launch frenet_plan frenet_with_test.launch.py
```

è¿™ä¼šåŒæ—¶å¯åŠ¨ï¼š
- Frenetè§„åˆ’å™¨èŠ‚ç‚¹
- æµ‹è¯•æ•°æ®å‘å¸ƒå™¨

### æ–¹æ³•2: åˆ†åˆ«å¯åŠ¨

**ç»ˆç«¯1 - å¯åŠ¨è§„åˆ’å™¨:**
```bash
source install/setup.bash
ros2 launch frenet_plan frenet_planner.launch.py
```

**ç»ˆç«¯2 - å¯åŠ¨æµ‹è¯•å‘å¸ƒå™¨:**
```bash
source install/setup.bash
ros2 run frenet_plan test_publisher.py
```

## å¯è§†åŒ–éªŒè¯

### åœ¨RVizä¸­æŸ¥çœ‹

1. **å¯åŠ¨RViz**
```bash
rviz2
```

2. **æ·»åŠ æ˜¾ç¤ºé¡¹:**

| Display Type | Topic | è¯´æ˜ |
|-------------|-------|------|
| Map | `/costmap` | ä»£ä»·åœ°å›¾ |
| Path | `/local_path_plan` | å‚è€ƒè·¯å¾„ï¼ˆçº¢è‰²ï¼‰ |
| Path | `/frenet_path` | è§„åˆ’è½¨è¿¹ï¼ˆç»¿è‰²ï¼‰ |
| MarkerArray | `/frenet_trajectories` | æ‰€æœ‰å€™é€‰è½¨è¿¹ |
| Odometry | `/odom` | è½¦è¾†ä½ç½® |

3. **è®¾ç½®Fixed Frame**: `map`

### é¢„æœŸæ•ˆæœ

âœ… **æ­£å¸¸é¿éšœè¡Œä¸º:**
- è½¦è¾†ä»x=6må‡ºå‘
- åœ¨x=8må¤„é‡åˆ°éšœç¢1ï¼ˆy=0.5mï¼‰ï¼Œè½¨è¿¹å‘å·¦æˆ–å‘å³é¿å¼€
- åœ¨x=12må¤„é‡åˆ°éšœç¢2ï¼ˆy=-0.8mï¼‰ï¼Œé€‰æ‹©å¦ä¸€ä¾§é¿å¼€
- æœ€ç»ˆè½¨è¿¹åœ¨é“è·¯è¾¹ç•Œå†…ï¼ˆÂ±1.5mï¼‰

## è¯é¢˜ç›‘æ§

### æ£€æŸ¥æ•°æ®å‘å¸ƒ
```bash
# æ£€æŸ¥æ‰€æœ‰è¯é¢˜
ros2 topic list

# æŸ¥çœ‹costmapæ•°æ®
ros2 topic echo /costmap --once

# ç›‘æ§è§„åˆ’é¢‘ç‡
ros2 topic hz /frenet_path

# æŸ¥çœ‹costmapä¿¡æ¯
ros2 topic info /costmap
```

### é¢„æœŸè¾“å‡º
```
/costmap: nav_msgs/msg/OccupancyGrid
  - width: 200 (20m)
  - height: 100 (10m)
  - resolution: 0.1
  - data: array of 20000 int8 values
```

## å‚æ•°è°ƒæ•´

### è½¦è¾†å°ºå¯¸
æ ¹æ®å®é™…è½¦è¾†è°ƒæ•´ï¼š
```yaml
vehicle_length: 1.2  # ä¾‹å¦‚å°å‹è½¿è½¦
vehicle_width: 0.7
```

### éšœç¢ç‰©æ•æ„Ÿåº¦
```yaml
# ä¿å®ˆï¼ˆæ›´å®‰å…¨ï¼Œæå‰é¿éšœï¼‰
costmap_obstacle_threshold: 30

# æ ‡å‡†
costmap_obstacle_threshold: 50

# æ¿€è¿›ï¼ˆè´´è¿‘éšœç¢ç‰©ï¼‰
costmap_obstacle_threshold: 70
```

## æ•…éšœæ’æŸ¥

### é—®é¢˜1: æ²¡æœ‰çœ‹åˆ°costmap
**æ£€æŸ¥:**
```bash
ros2 topic echo /costmap --once
```
**è§£å†³:** ç¡®ä¿test_publisher.pyæ­£åœ¨è¿è¡Œ

### é—®é¢˜2: æ‰€æœ‰è½¨è¿¹éƒ½è¢«è¿‡æ»¤
**åŸå› :** 
- è½¦è¾†å°ºå¯¸è®¾ç½®è¿‡å¤§
- éšœç¢ç‰©é˜ˆå€¼è¿‡ä½
- é“è·¯å®½åº¦ä¸è¶³

**è§£å†³:**
```yaml
vehicle_length: 0.8  # å‡å°è½¦è¾†å°ºå¯¸
vehicle_width: 0.5
costmap_obstacle_threshold: 60  # æé«˜é˜ˆå€¼
```

### é—®é¢˜3: æ²¡æœ‰é¿å¼€éšœç¢ç‰©
**æ£€æŸ¥costmapå€¼:**
```bash
ros2 topic echo /costmap --once | grep -A 5 data
```
**è§£å†³:** ç¡®ä¿éšœç¢ç‰©ä½ç½®ä»£ä»·å€¼>=50

## æ€§èƒ½æµ‹è¯•

### ç›‘æ§è§„åˆ’æ€§èƒ½
```bash
# æŒç»­ç›‘æ§é¢‘ç‡
ros2 topic hz /frenet_path

# æ£€æŸ¥CPUä½¿ç”¨ç‡
top -p $(pgrep -f frenet_plan_node)
```

### é¢„æœŸæ€§èƒ½
- **æ— costmap**: ~43 Hz
- **æœ‰costmapï¼ˆçŸ©å½¢æ£€æµ‹ï¼‰**: 35-40 Hz
- **å†…å­˜**: < 50 MB

## ä¸‹ä¸€æ­¥

### é›†æˆçœŸå®ä¼ æ„Ÿå™¨
å°†æµ‹è¯•è¯é¢˜æ›¿æ¢ä¸ºå®é™…ä¼ æ„Ÿå™¨ï¼š
```yaml
# ä½¿ç”¨çœŸå®æ•°æ®æº
remappings=[
    ('/costmap', '/local_costmap/costmap'),    # Nav2
    ('/odom', '/wheel_odom'),                  # è½®é€Ÿè®¡
    ('/local_path_plan', '/path_planner/path'), # ä¸Šå±‚è§„åˆ’å™¨
]
```

### æ·»åŠ åŠ¨æ€éšœç¢ç‰©
ä¿®æ”¹test_publisher.pyï¼Œè®©éšœç¢ç‰©éšæ—¶é—´ç§»åŠ¨ï¼š
```python
# åœ¨create_test_costmapä¸­æ·»åŠ æ—¶é—´å‚æ•°
def create_dynamic_costmap(self, t):
    # éšœç¢ç‰©ä½ç½®éšæ—¶é—´å˜åŒ–
    obs_x = 10.0 + 2.0 * math.sin(t)
    ...
```

## æ€»ç»“

âœ… **å·²å®ç°:**
- çŸ©å½¢è½¦è¾†ç¢°æ’æ£€æµ‹
- å®Œæ•´çš„æµ‹è¯•ç¯å¢ƒï¼ˆè·¯å¾„+é€Ÿåº¦+é‡Œç¨‹è®¡+ä»£ä»·åœ°å›¾ï¼‰
- ä¸€é”®å¯åŠ¨æµ‹è¯•
- å¯è§†åŒ–æ”¯æŒ

ğŸ¯ **æ¨èé…ç½®:**
```yaml
vehicle_length: 1.0
vehicle_width: 0.6
costmap_obstacle_threshold: 50
```

è¿™ä¸ªé…ç½®é€‚åˆå¤§å¤šæ•°å›­åŒºå°è½¦åœºæ™¯ã€‚

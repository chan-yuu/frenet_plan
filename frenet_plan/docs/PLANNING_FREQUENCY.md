# 规划频率说明

## 当前配置

在 `config/frenet_params.yaml` 中设置：
```yaml
planning_frequency: 40.0  # 规划频率 (Hz)
```

## 实际运行频率分析

### 为什么实际频率(43Hz)低于设置频率(50Hz)?

这是**正常现象**，原因包括：

1. **计算负载**
   - 当前配置生成约 **16横向 × 7时间 × 4速度 ≈ 448条候选轨迹**
   - 每条轨迹需要计算多项式、坐标转换、代价评估
   - 总计算时间约 20-25ms

2. **系统开销**
   - ROS2消息发布/订阅
   - 定时器调度延迟
   - 其他进程抢占CPU

3. **性能表现**
   ```
   average rate: 43.301 Hz
   min: 0.001s  (1000 Hz - 最快循环)
   max: 0.029s  (34 Hz - 最慢循环)
   std dev: 0.00394s (标准差小，稳定性好)
   ```

## 频率建议

### 园区低速场景 (0-3 m/s)
- **推荐**: 20-40 Hz
- **当前43Hz**: ✅ 非常好
- **理由**: 低速下轨迹变化慢，不需要过高频率

### 不同场景的频率设置

| 场景 | 速度范围 | 建议频率 | 说明 |
|------|---------|---------|------|
| 园区巡航 | 0-3 m/s | 20-30 Hz | 稳定即可 |
| 园区避障 | 0-3 m/s | 30-40 Hz | 当前设置 ✅ |
| 高速公路 | 10-30 m/s | 40-50 Hz | 需要更高频率 |
| 赛道运动 | >30 m/s | 50-100 Hz | 极高要求 |

## 优化建议

### 如果需要提高实际频率：

1. **减少候选轨迹数量**
   ```yaml
   d_road_sample: 0.3      # 0.2 → 0.3 减少横向采样
   t_sample: 0.4           # 0.3 → 0.4 减少时间采样
   ```
   轨迹数量: 448 → 286条 (减少36%)

2. **缩短规划时间窗口**
   代码中已设置为 2.0-4.0秒（低速场景合适）

3. **降低目标频率**
   ```yaml
   planning_frequency: 30.0  # 更保守的设置
   ```

### 如果频率过高导致计算不过来：

当实际频率远低于设置频率时（如设置50Hz实际只有20Hz）：
```yaml
planning_frequency: 30.0  # 降低期望频率
```

## 监控命令

```bash
# 监控规划频率
ros2 topic hz /frenet_path

# 监控所有话题
ros2 topic hz /frenet_path /frenet_vel /frenet_trajectories

# 查看节点性能
ros2 node info /frenet_planner
```

## 总结

**当前状态**: ✅ 正常运行
- 设置频率: 40 Hz (25ms周期)
- 实际频率: 43.3 Hz 
- 稳定性: 优秀 (std dev: 3.94ms)

对于园区低速场景，这个性能表现**完全满足要求**。
